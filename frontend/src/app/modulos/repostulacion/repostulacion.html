<div class="login-container">
  <div class="login-content" style="max-width: 540px;">

    <div class="login-header">
      <div class="logo-box">
        <img src="imgs/logo-uteq.png" alt="UTEQ" class="logo">
      </div>
      <h1 class="title">Re-postulación</h1>
      <p class="subtitle">Actualiza tus documentos para postular de nuevo</p>
    </div>

    <!-- Banner convocatoria -->
    <div class="conv-banner" *ngIf="nombreConvocatoria">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none"
           stroke="#00A63E" stroke-width="2">
        <path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586
                 a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
      </svg>
      <span>Convocatoria: <strong>{{ nombreConvocatoria }}</strong></span>
    </div>

    <div class="login-card">

      <div class="info-alert">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <line x1="12" y1="8" x2="12" y2="12"/>
          <line x1="12" y1="16" x2="12.01" y2="16"/>
        </svg>
        <p>Ingresa tu cédula para verificar tu solicitud anterior. Luego sube
          los nuevos documentos para re-postular.</p>
      </div>

      <div *ngIf="error" class="server-error">{{ error }}</div>

      <!-- Éxito -->
      <div class="success-msg" *ngIf="exito">
        ✅ {{ mensajeExito }}
        <button class="btn-ir-inicio" (click)="irAInicio()">Ir al inicio</button>
      </div>

      <ng-container *ngIf="!exito">

        <!-- Paso 1: verificar cédula -->
        <ng-container *ngIf="!cedulaVerificada">
          <h3 class="form-title">Verificar identidad</h3>
          <div class="form-group">
            <label>CÉDULA / PASAPORTE</label>
            <div class="input-wrapper">
              <svg class="input-icon" xmlns="http://www.w3.org/2000/svg" fill="none"
                   viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M10 6H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V8
                     a2 2 0 00-2-2h-5m-4 0V5a2 2 0 114 0v1m-4 0a2 2 0 104
                     0m-5 8a2 2 0 100-4 2 2 0 000 4zm0 0c1.306 0 2.417.835
                     2.83 2M9 14a3.001 3.001 0 00-2.83 2M15 11h3m-3 4h2"/>
              </svg>
              <input type="text" class="form-input with-icon"
                     [(ngModel)]="cedula" name="cedula"
                     placeholder="Ingrese su cédula" maxlength="10">
            </div>
          </div>
          <button class="btn-submit" (click)="verificarCedula()"
                  [disabled]="verificando || !cedula">
            {{ verificando ? 'Verificando...' : 'Verificar' }}
          </button>
        </ng-container>

        <!-- Paso 2: subir documentos -->
        <ng-container *ngIf="cedulaVerificada">

          <div class="verified-badge">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
                 stroke="currentColor" stroke-width="2">
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
              <polyline points="22 4 12 14.01 9 11.01"/>
            </svg>
            Identidad verificada — {{ cedula }}
          </div>

          <h3 class="form-title" style="margin-top:1.5rem;">Nuevos documentos</h3>
          <p class="form-subtitle">Sube los documentos actualizados</p>

          <!-- Cédula PDF -->
          <div class="form-group">
            <label>CÉDULA / PASAPORTE (PDF)</label>
            <div class="file-upload-box" [class.has-file]="!!archivoCedula">
              <input type="file" id="fileCedula" accept=".pdf"
                     (change)="onFileCedulaSelected($event)" hidden>
              <label for="fileCedula" class="file-label">
                <svg *ngIf="!archivoCedula" width="22" height="22" viewBox="0 0 24 24"
                     fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12
                           a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/>
                </svg>
                <svg *ngIf="archivoCedula" width="22" height="22" viewBox="0 0 24 24"
                     fill="none" stroke="#00A63E" stroke-width="2">
                  <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                  <polyline points="22 4 12 14.01 9 11.01"/>
                </svg>
                <span>{{ archivoCedula ? nombreArchivoCedula : 'Subir cédula (PDF)' }}</span>
              </label>
            </div>
          </div>

          <!-- Foto -->
          <div class="form-group">
            <label>FOTO (JPG / PNG)</label>
            <div class="file-upload-box" [class.has-file]="!!archivoFoto">
              <input type="file" id="fileFoto" accept="image/*"
                     (change)="onFileFotoSelected($event)" hidden>
              <label for="fileFoto" class="file-label">
                <svg *ngIf="!archivoFoto" width="22" height="22" viewBox="0 0 24 24"
                     fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                  <circle cx="8.5" cy="8.5" r="1.5"/>
                  <polyline points="21 15 16 10 5 21"/>
                </svg>
                <svg *ngIf="archivoFoto" width="22" height="22" viewBox="0 0 24 24"
                     fill="none" stroke="#00A63E" stroke-width="2">
                  <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                  <polyline points="22 4 12 14.01 9 11.01"/>
                </svg>
                <span>{{ archivoFoto ? nombreArchivoFoto : 'Subir foto' }}</span>
              </label>
            </div>
          </div>

          <!-- Prerrequisitos -->
          <div class="form-group">
            <label>PRERREQUISITOS (PDF)</label>
            <div class="file-upload-box" [class.has-file]="!!archivoPrerrequisitos">
              <input type="file" id="filePre" accept=".pdf"
                     (change)="onFilePreSelected($event)" hidden>
              <label for="filePre" class="file-label">
                <svg *ngIf="!archivoPrerrequisitos" width="22" height="22"
                     viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12
                           a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/>
                </svg>
                <svg *ngIf="archivoPrerrequisitos" width="22" height="22"
                     viewBox="0 0 24 24" fill="none" stroke="#00A63E" stroke-width="2">
                  <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                  <polyline points="22 4 12 14.01 9 11.01"/>
                </svg>
                <span>{{ archivoPrerrequisitos ? nombreArchivoPrerrequisitos
                  : 'Subir prerrequisitos (PDF)' }}</span>
              </label>
            </div>
          </div>

          <button class="btn-submit" (click)="enviarRepostulacion()" [disabled]="enviando">
            {{ enviando ? 'Enviando...' : 'Enviar Re-postulación' }}
          </button>

          <button class="btn-back-link" (click)="cedulaVerificada = false">
            ← Cambiar cédula
          </button>

        </ng-container>
      </ng-container>

    </div>

    <div class="form-footer">© 2026 Universidad Técnica Estatal de Quevedo</div>
  </div>
</div>
